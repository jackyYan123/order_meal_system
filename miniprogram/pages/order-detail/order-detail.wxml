<!-- pages/order-detail/order-detail.wxml -->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  <!-- è®¢å•è¯¦æƒ… -->
  <view class="order-detail" wx:if="{{!loading && orderInfo}}">
    <!-- è®¢å•çŠ¶æ€ -->
    <view class="status-card">
      <view class="status-icon">âœ…</view>
      <view class="status-info">
        <view class="status-text" style="color: {{orderInfo.statusColor}}">
          {{orderInfo.statusText}}
        </view>
        <view class="status-tip">{{orderInfo.statusText === 'å¾…ç¡®è®¤' ? 'è®¢å•å·²æäº¤æˆåŠŸ' : 'è®¢å•å¤„ç†ä¸­'}}</view>
      </view>
    </view>
    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">è®¢å•ä¿¡æ¯</view>
      <view class="info-row">
        <text class="info-label">è®¢å•å·ï¼š</text>
        <text class="info-value">{{orderInfo.orderNo}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ¡Œå°ï¼š</text>
        <text class="info-value">{{orderInfo.tableName}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è®¢å•çŠ¶æ€ï¼š</text>
        <text class="info-value status-text" style="color: {{orderInfo.statusColor}}">
          {{orderInfo.statusText}}
        </text>
      </view>
      <view class="info-row">
        <text class="info-label">æ”¯ä»˜çŠ¶æ€ï¼š</text>
        <text class="info-value payment-status" style="color: {{orderInfo.paymentStatusColor}}">
          {{orderInfo.paymentStatusText}}
        </text>
      </view>
      <view class="info-row">
        <text class="info-label">ä¸‹å•æ—¶é—´ï¼š</text>
        <text class="info-value">{{orderInfo.createdAt || '--'}}</text>
      </view>
      <view class="info-row" wx:if="{{orderInfo.paymentTime}}">
        <text class="info-label">æ”¯ä»˜æ—¶é—´ï¼š</text>
        <text class="info-value">{{orderInfo.paymentTime}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">é¢„è®¡å®Œæˆï¼š</text>
        <text class="info-value estimated-time">{{orderInfo.estimatedTime || '--'}}</text>
      </view>
      <view class="info-row" wx:if="{{orderInfo.completedTime}}">
        <text class="info-label">å®Œæˆæ—¶é—´ï¼š</text>
        <text class="info-value">{{orderInfo.completedTime}}</text>
      </view>
      <view class="info-row" wx:if="{{orderInfo.remarks}}">
        <text class="info-label">å¤‡æ³¨ï¼š</text>
        <text class="info-value">{{orderInfo.remarks}}</text>
      </view>
    </view>
    <!-- å•†å“åˆ—è¡¨ -->
    <view class="items-card">
      <view class="card-title">è®¢å•å•†å“</view>
      <view class="item-list">
        <view class="order-item" wx:for="{{orderInfo.items}}" wx:key="id">
          <image class="item-image" src="{{item.dishImage || '/images/default-dish.png'}}" mode="aspectFill"></image>
          <view class="item-info">
            <view class="item-name">{{item.dishName}}</view>
            <view class="item-price">{{item.formattedDishPrice}}</view>
            <view class="item-special" wx:if="{{item.specialRequests}}">
              å¤‡æ³¨ï¼š{{item.specialRequests}}
            </view>
          </view>
          <view class="item-quantity">Ã—{{item.quantity}}</view>
          <view class="item-subtotal">{{item.formattedSubtotal}}</view>
        </view>
      </view>
    </view>
    <!-- è®¢å•æ€»ä»· -->
    <view class="total-card">
      <view class="total-row">
        <text class="total-label">è®¢å•æ€»è®¡</text>
        <text class="total-amount">{{orderInfo.formattedTotalAmount}}</text>
      </view>
    </view>
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <!-- æ”¯ä»˜æŒ‰é’® -->
      <button class="action-btn primary" 
              wx:if="{{canPay()}}" 
              bindtap="goToPayment">
        ç«‹å³æ”¯ä»˜
      </button>
      
      <!-- ä¸´æ—¶æ”¯ä»˜æŒ‰é’®ï¼ˆç”¨äºè°ƒè¯•ï¼‰ -->
      <button class="action-btn primary" 
              wx:if="{{orderInfo && orderInfo.paymentStatus === 'UNPAID'}}" 
              bindtap="goToPayment"
              style="background-color: #ff3b30;">
        ğŸ”¥ ç«‹å³æ”¯ä»˜ (è°ƒè¯•)
      </button>
      
      <!-- å–æ¶ˆè®¢å•æŒ‰é’® -->
      <button class="action-btn danger" 
              wx:if="{{canCancel()}}" 
              bindtap="cancelOrder">
        å–æ¶ˆè®¢å•
      </button>
      
      <!-- åˆ·æ–°æŒ‰é’® -->
      <button class="action-btn secondary" bindtap="refreshOrder">åˆ·æ–°çŠ¶æ€</button>
      
      <!-- ç»§ç»­ç‚¹é¤æŒ‰é’® -->
      <button class="action-btn secondary" bindtap="goMenu">ç»§ç»­ç‚¹é¤</button>
      
      <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
      <button class="action-btn primary" bindtap="goHome">è¿”å›é¦–é¡µ</button>
    </view>
  </view>
  <!-- è®¢å•ä¸å­˜åœ¨ -->
  <view class="no-order" wx:if="{{!loading && !orderInfo}}">
    <view class="no-order-icon">âŒ</view>
    <view class="no-order-text">è®¢å•ä¸å­˜åœ¨</view>
    <button class="back-btn" bindtap="goHome">è¿”å›é¦–é¡µ</button>
  </view>
</view>