<!--pages/payment/payment.wxml-->
<view class="container">
  <view wx:if="{{!loading && order}}">
    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="order-section card">
      <view class="order-header">
        <view class="order-title">è®¢å•ä¿¡æ¯</view>
        <button class="detail-btn" bindtap="viewOrderDetail">æŸ¥çœ‹è¯¦æƒ…</button>
      </view>
      
      <view class="order-info">
        <view class="info-item">
          <text class="label">è®¢å•å·</text>
          <text class="value">{{order.orderNo}}</text>
        </view>
        <view class="info-item">
          <text class="label">æ¡Œå°</text>
          <text class="value">{{order.tableName}}</text>
        </view>
        <view class="info-item">
          <text class="label">å•†å“æ•°é‡</text>
          <text class="value">{{order.items.length}}ç§å•†å“</text>
        </view>
      </view>
    </view>

    <!-- æ”¯ä»˜é‡‘é¢ -->
    <view class="amount-section card">
      <view class="amount-header">
        <text class="amount-label">æ”¯ä»˜é‡‘é¢</text>
        <text class="amount-value">{{order.formattedTotalAmount}}</text>
      </view>
      
      <view class="amount-detail">
        <view class="detail-item">
          <text class="label">å•†å“æ€»è®¡</text>
          <text class="value">{{order.formattedDishAmount}}</text>
        </view>
        <view class="detail-item" wx:if="{{order.serviceAmount > 0}}">
          <text class="label">æœåŠ¡è´¹</text>
          <text class="value">{{order.formattedServiceAmount}}</text>
        </view>
        <view class="detail-item" wx:if="{{order.discountAmount > 0}}">
          <text class="label">ä¼˜æƒ é‡‘é¢</text>
          <text class="value discount">-{{order.formattedDiscountAmount}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¯ä»˜æ–¹å¼ -->
    <view class="payment-methods card">
      <view class="card-header">é€‰æ‹©æ”¯ä»˜æ–¹å¼</view>
      
      <view class="method-list">
        <view class="method-item {{selectedPaymentMethod === item.id ? 'selected' : ''}}"
              wx:for="{{paymentMethods}}"
              wx:key="id"
              data-method="{{item.id}}"
              bindtap="selectPaymentMethod">
          
          <view class="method-info">
            <text class="method-icon">{{item.icon}}</text>
            <view class="method-details">
              <view class="method-name">{{item.name}}</view>
              <view class="method-desc">{{item.desc}}</view>
            </view>
          </view>
          
          <view class="method-radio">
            <view class="radio-inner" wx:if="{{selectedPaymentMethod === item.id}}"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®‰å…¨æç¤º -->
    <view class="security-tips card">
      <view class="tips-header">
        <text class="security-icon">ğŸ”’</text>
        <text class="tips-title">å®‰å…¨æ”¯ä»˜</text>
      </view>
      <view class="tips-content">
        <text>â€¢ æ”¯ä»˜è¿‡ç¨‹é‡‡ç”¨é“¶è¡Œçº§åŠ å¯†æŠ€æœ¯</text>
        <text>â€¢ æ‚¨çš„æ”¯ä»˜ä¿¡æ¯å°†å¾—åˆ°ä¸¥æ ¼ä¿æŠ¤</text>
        <text>â€¢ æ”¯æŒ7Ã—24å°æ—¶å®¢æœæœåŠ¡</text>
      </view>
    </view>
  </view>

  <!-- æ”¯ä»˜æŒ‰é’® -->
  <view class="payment-footer" wx:if="{{!loading && order}}">
    <view class="footer-amount">
      <text class="footer-label">å®ä»˜é‡‘é¢</text>
      <text class="footer-price">{{order.formattedTotalAmount}}</text>
    </view>
    <button class="pay-btn" 
            bindtap="confirmPayment"
            disabled="{{paying}}">
      {{paying ? 'æ”¯ä»˜ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}}
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ”¯ä»˜é®ç½© -->
  <view class="payment-mask" wx:if="{{paying}}">
    <view class="payment-content">
      <view class="payment-spinner"></view>
      <text class="payment-text">æ”¯ä»˜ä¸­ï¼Œè¯·ç¨å€™...</text>
      <text class="payment-tip">è¯·åœ¨å¾®ä¿¡ä¸­å®Œæˆæ”¯ä»˜</text>
    </view>
  </view>
</view>