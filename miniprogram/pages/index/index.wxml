<!-- pages/index/index.wxml -->
<view class="container">
  <!-- æ¡Œå°ä¿¡æ¯ -->
  <view class="table-info">
    <view class="table-info-content">
      <view class="table-icon">ğŸ½ï¸</view>
      <view class="table-details">
        <view class="table-name">{{tableInfo.name}}</view>
        <view class="table-tip" wx:if="{{!tableInfo.id}}">æ‰«ç é€‰æ‹©æ‚¨çš„æ¡Œå°</view>
      </view>
    </view>
    <button class="scan-btn btn btn-primary" bindtap="scanTable">
      {{tableInfo.id ? 'æ›´æ¢æ¡Œå°' : 'æ‰«ç é€‰å°'}}
    </button>
  </view>
  <!-- ç”¨æˆ·æ¬¢è¿ -->
  <view class="welcome-section" wx:if="{{userInfo}}">
    <view class="welcome-text">
      <text class="greeting">æ‚¨å¥½ï¼Œ{{userInfo.nickName || 'é¡¾å®¢'}}ï¼</text>
      <text class="sub-greeting">æ¬¢è¿æ¥åˆ°æ™ºæ…§ç‚¹é¤</text>
    </view>
    <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
  </view>
  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions card">
    <view class="card-header">å¿«é€Ÿæ“ä½œ</view>
    <view class="action-grid">
      <view class="action-item" bindtap="goToMenu">
        <view class="action-icon">ğŸ“‹</view>
        <view class="action-text">æµè§ˆèœå•</view>
      </view>
      <view class="action-item" bindtap="goToCart">
        <view class="action-icon-wrapper">
          <view class="action-icon">ğŸ›’</view>
          <view class="cart-badge" wx:if="{{cartCount > 0}}">{{cartCount}}</view>
        </view>
        <view class="action-text">è´­ç‰©è½¦</view>
      </view>
      <view class="action-item" bindtap="goToOrder">
        <view class="action-icon">ğŸ“</view>
        <view class="action-text">æˆ‘çš„è®¢å•</view>
      </view>
      <view class="action-item" bindtap="goToProfile">
        <view class="action-icon">ğŸ‘¤</view>
        <view class="action-text">ä¸ªäººä¸­å¿ƒ</view>
      </view>
    </view>
  </view>
  <!-- èœå“åˆ†ç±» -->
  <view class="categories-section card" wx:if="{{categories.length > 0}}">
    <view class="card-header">èœå“åˆ†ç±»</view>
    <view class="categories-container">
      <view class="category-item" wx:for="{{categories}}" wx:key="id" data-category-id="{{item.id}}" bindtap="goToCategoryMenu">
        <image class="category-image" src="{{item.cover}}" mode="aspectFill"></image>
        <view class="category-name">{{item.name}}</view>
      </view>
    </view>
  </view>
  <!-- æ¨èèœå“ -->
  <view class="dishes-section card" wx:if="{{recommendedDishes.length > 0}}">
    <view class="card-header">
      <text>ä»Šæ—¥æ¨è</text>
      <text class="more-link" bindtap="goToMenu">æŸ¥çœ‹æ›´å¤š ></text>
    </view>
    <view class="dishes-grid">
      <view class="dish-item" wx:for="{{recommendedDishes}}" wx:key="id" data-dish="{{item}}" data-dish-id="{{item.id}}">
        <image class="dish-image" src="{{item.imageUrl}}" mode="aspectFill" bindtap="viewDishDetail"></image>
        <view class="dish-info">
          <view class="dish-name" bindtap="viewDishDetail">{{item.name}}</view>
          <view class="dish-desc">{{item.description}}</view>
          <view class="dish-footer">
            <view class="dish-price price price-medium">{{item.formattedPrice}}</view>
            <button class="add-btn btn btn-primary" size="mini" data-dish="{{item}}" bindtap="addToCart">
              +
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- çƒ­é—¨èœå“ -->
  <view class="dishes-section card" wx:if="{{popularDishes.length > 0}}">
    <view class="card-header">
      <text>çƒ­é—¨èœå“</text>
      <text class="more-link" bindtap="goToMenu">æŸ¥çœ‹æ›´å¤š ></text>
    </view>
    <view class="dishes-list">
      <view class="dish-item-horizontal" wx:for="{{popularDishes}}" wx:key="id" data-dish="{{item}}" data-dish-id="{{item.id}}">
        <image class="dish-image-small" src="{{item.imageUrl}}" mode="aspectFill" bindtap="viewDishDetail"></image>
        <view class="dish-info-horizontal">
          <view class="dish-name" bindtap="viewDishDetail">{{item.name}}</view>
          <view class="dish-desc">{{item.description}}</view>
          <view class="dish-footer">
            <view class="dish-price price price-medium">{{item.formattedPrice}}</view>
            <button class="add-btn btn btn-primary" size="mini" data-dish="{{item}}" bindtap="addToCart">
              +
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && categories.length === 0}}">
    <image class="empty-icon" src="/images/empty.png"></image>
    <text>æš‚æ— æ•°æ®</text>
  </view>
</view>