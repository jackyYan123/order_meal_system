<!-- pages/cart/cart.wxml -->
<view class="container">
    <!-- æ¡Œå°ä¿¡æ¯ -->
    <view class="table-info card" wx:if="{{tableInfo.id}}">
        <view class="table-icon">ğŸ½ï¸</view>
        <view class="table-details">
            <view class="table-name">{{tableInfo.name}}</view>
            <view class="table-tip">å½“å‰é€‰æ‹©çš„æ¡Œå°</view>
        </view>
        <button class="change-table-btn" bindtap="selectTable">æ›´æ¢</button>
    </view>
    <!-- æœªé€‰æ‹©æ¡Œå°æç¤º -->
    <view class="no-table-tip" wx:if="{{!tableInfo.id}}">
        <view class="tip-icon">âš ï¸</view>
        <view class="tip-text">è¯·å…ˆé€‰æ‹©æ¡Œå°</view>
        <button class="select-table-btn" bindtap="selectTable">é€‰æ‹©æ¡Œå°</button>
    </view>
    <!-- è´­ç‰©è½¦å•†å“åˆ—è¡¨ -->
    <view class="cart-section" wx:if="{{cartItems.length > 0}}">
        <view class="section-header">
            <text class="section-title">è´­ç‰©è½¦å•†å“ ({{totalCount}})</text>
            <button class="clear-btn" bindtap="clearCart">æ¸…ç©º</button>
        </view>
        <view class="cart-list">
            <view class="cart-item" wx:for="{{cartItems}}" wx:key="dishId" wx:for-index="index">
                <!-- å•†å“å›¾ç‰‡ -->
                <image class="item-image" src="{{item.image || '/images/default-dish.png'}}" mode="aspectFill"></image>
                <!-- å•†å“ä¿¡æ¯ -->
                <view class="item-info">
                    <view class="item-name">{{item.dishName}}</view>
                    <view class="item-price">{{item.formattedPrice}}</view>
                    <!-- ç‰¹æ®Šè¦æ±‚ -->
                    <view class="special-requests" wx:if="{{item.specialRequests}}">
                        <text class="requests-label">å¤‡æ³¨ï¼š</text>
                        <text class="requests-text">{{item.specialRequests}}</text>
                    </view>
                    <button class="add-requests-btn" data-index="{{index}}" bindtap="addSpecialRequest">
                        {{item.specialRequests ? 'ä¿®æ”¹å¤‡æ³¨' : 'æ·»åŠ å¤‡æ³¨'}}
                    </button>
                </view>
                <!-- æ•°é‡æ§åˆ¶ -->
                <view class="quantity-controls">
                    <button class="quantity-btn minus-btn" data-index="{{index}}" bindtap="decreaseQuantity">
                        -
                    </button>
                    <text class="quantity-text">{{item.quantity}}</text>
                    <button class="quantity-btn plus-btn" data-index="{{index}}" bindtap="increaseQuantity">
                        +
                    </button>
                </view>
                <!-- å°è®¡ -->
                <view class="item-subtotal">{{item.formattedSubtotal}}</view>
            </view>
        </view>
        <!-- è®¢å•å¤‡æ³¨ -->
        <view class="remarks-section">
            <view class="remarks-label">è®¢å•å¤‡æ³¨</view>
            <textarea class="remarks-input {{inputFocused ? 'focused' : ''}}" placeholder="è¯·è¾“å…¥è®¢å•å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰" value="{{remarks}}" bindinput="onRemarksInput" bindfocus="onRemarksFocus" bindblur="onRemarksBlur" maxlength="200"></textarea>
        </view>
    </view>
    <!-- ç©ºè´­ç‰©è½¦ -->
    <view class="empty-cart" wx:if="{{cartItems.length === 0}}">
        <image class="empty-icon" src="/images/empty-cart.png" mode="aspectFit"></image>
        <view class="empty-text">è´­ç‰©è½¦è¿˜æ˜¯ç©ºçš„</view>
        <view class="empty-tip">å¿«å»é€‰æ‹©å–œæ¬¢çš„èœå“å§</view>
        <button class="continue-shopping-btn" bindtap="continueShopping">å»é€›é€›</button>
    </view>
    <!-- åº•éƒ¨ç»“ç®—æ  -->
    <view class="bottom-bar" wx:if="{{cartItems.length > 0}}">
        <view class="total-info">
            <view class="total-count">å…±{{totalCount}}ä»¶å•†å“</view>
            <view class="total-price">
                <text class="price-label">åˆè®¡ï¼š</text>
                <text class="price-value">{{formattedTotalPrice}}</text>
            </view>
        </view>
        <button class="submit-btn {{!tableInfo.id || submitting ? 'disabled' : ''}}" bindtap="submitOrder" disabled="{{!tableInfo.id || submitting}}">
            {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}}
        </button>
    </view>
</view>