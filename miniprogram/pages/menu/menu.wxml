<!-- pages/menu/menu.wxml -->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar" wx:if="{{showSearch}}">
    <input class="search-input" placeholder="æœç´¢èœå“..." value="{{searchKeyword}}" bindinput="onSearchInput" focus="{{showSearch}}" />
    <button class="search-cancel" bindtap="toggleSearch">å–æ¶ˆ</button>
  </view>
  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="category-nav" wx:if="{{!showSearch}}">
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-item {{currentCategoryId === null ? 'active' : ''}}" data-category-id="{{null}}" bindtap="switchCategory">
        å…¨éƒ¨
      </view>
      <view class="category-item {{currentCategoryId === item.id ? 'active' : ''}}" wx:for="{{categories}}" wx:key="id" data-category-id="{{item.id}}" bindtap="switchCategory">
        {{item.name}}
      </view>
    </scroll-view>
    <button class="search-btn" bindtap="toggleSearch">ğŸ”</button>
  </view>
  <!-- èœå“åˆ—è¡¨ -->
  <view class="dishes-container">
    <view class="dish-item" wx:for="{{dishes}}" wx:key="id" data-dish="{{item}}" data-dish-id="{{item.id}}">
      <!-- èœå“å›¾ç‰‡ -->
      <image class="dish-image" src="{{item.image || item.imageUrl || '/images/default-dish.png'}}" mode="aspectFill" bindtap="viewDishDetail" binderror="onImageError"></image>
      <!-- èœå“ä¿¡æ¯ -->
      <view class="dish-info">
        <view class="dish-header">
          <view class="dish-name" bindtap="viewDishDetail">{{item.name}}</view>
          <view class="dish-tags" wx:if="{{item.tags}}">
            <text class="tag tag-info" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        <view class="dish-desc">{{item.description}}</view>
        <view class="dish-footer">
          <view class="price-section">
            <text class="dish-price price price-large">{{item.formattedPrice}}</text>
            <text class="dish-stock" wx:if="{{item.stock <= 10 && item.stock > 0}}">
              ä»…å‰©{{item.stock}}ä»½
            </text>
            <text class="dish-stock sold-out" wx:if="{{item.stock <= 0}}">å·²å”®ç½„</text>
          </view>
          <!-- è´­ç‰©è½¦æ“ä½œ -->
          <view class="cart-controls" wx:if="{{item.stock > 0}}">
            <button class="cart-btn minus-btn {{item.cartQuantity > 0 ? 'visible' : 'hidden'}}" data-dish="{{item}}" bindtap="removeFromCart">
              -
            </button>
            <text class="quantity {{item.cartQuantity > 0 ? 'visible' : 'hidden'}}">
              {{item.cartQuantity || 0}}
            </text>
            <button class="cart-btn plus-btn" data-dish="{{item}}" bindtap="addToCart">+</button>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && dishes.length === 0}}">
    <image class="empty-icon" src="/images/empty-dish.png"></image>
    <text>{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èœå“' : 'æš‚æ— èœå“'}}</text>
  </view>
  <!-- è´­ç‰©è½¦æ‚¬æµ®æŒ‰é’® -->
  <view class="cart-float" wx:if="{{cartCount > 0}}" bindtap="goToCart">
    <view class="cart-icon">ğŸ›’</view>
    <view class="cart-badge">{{cartCount}}</view>
  </view>
</view>